!function(s){s(".composite_data").on("wc-composite-initializing",function(i,c){(new function(){function e(i){return new(Backbone.Model.extend({initialize:function(i){c.actions.add_action("active_scenarios_updated",this.component_selection_changed_handler,20,this);this.set({active_scenarios:[]})},component_selection_changed_handler:function(i){for(var e=c.scenarios.get_active_scenarios_by_type("overlay_image"),n=c.scenarios.get_scenario_shaping_components(),t=_.difference(_.pluck(c.get_components(),"component_id"),n),a=0,o=t.length;a<o;a++)e=_.difference(e,c.scenarios.get_unmasked_scenarios(e,t[a]));this.set({active_scenarios:e})}}))(i)}function n(i){return new(Backbone.View.extend({$main_image_container:!1,$main_image:!1,initialize:function(i){this.$main_image_container=this.$el.find(".woocommerce-product-gallery__image").first(),this.$main_image=this.$main_image_container.find("a img").first(),this.listenTo(this.model,"change:active_scenarios",this.render);var e=this;$wc_cp_window.resize(function(){if(!c.is_initialized)return!1;var i={width:e.$main_image.innerWidth()};this.$main_image_container.find(".wc-cp-overlay-image").css(i)})},render:function(){var i=this.model.get("active_scenarios"),e={width:this.$main_image.innerWidth(),position:"absolute"};this.$main_image_container.find(".wc-cp-overlay-image").remove();for(var n=i.length-1;0<=n;n--){var t=i[n],a=c.scenarios.get_scenario_data().scenario_settings.overlay_image[t],o=s(a).css(e);a&&this.$main_image_container.prepend(o)}}}))(i)}this.initialize=function(){var i=s(".woocommerce-product-gallery__wrapper").first();0<i.length&&(this.model=new e,this.view=new n({model:this.model,el:i}))}}).initialize()})}(jQuery,window,document);